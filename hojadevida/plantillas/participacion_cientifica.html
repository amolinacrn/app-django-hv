{% extends "basehv.html" %}

{% load static %}
{% load crispy_forms_tags %}

{% block content_derecho%}

<!--ESTILO 1-->

<script>

  function RegistroExperienciaLaboral(condicional, id_explab = '{{ id_actual }}', nombre_evento_cientifico, tipo_evento,
    institucion_evento, ciudad_evento, departamento_evento,
    pais_evento, fecha_inicio_evento, fecha_fin_evento,
    modalidad_evento, soportes_eventos_cientificos) {

    experiencia_laboral.innerHTML = ``
    registro_experiencia_laboral.innerHTML = `
  <div class="class_div" >
    {% if errform %}
    <div style="margin:0px; padding: 1px;background-color: rgb(255, 0, 0); width:63%; margin-left: 5cm;">
      <h5 style="color: white;margin-top:5px;">
        <b>&nbsp&nbsp
          No se ha podido enviar los datos, por favor revise el formulario
        </b>
      </h5>
    </div>
    <br>
    {% endif%}
   
    <table style="width:100%">
          <tr>
            <td width="35px">
              <img src="{% static 'bs532/img/imghv/einstein.svg' %}" style="width: 100%;transform: scale(0.8)" alt="My image">
            </td>
            <td width="15px">

            </td>
            <td style="font-size:15px;">
              <b class="text-uppercase">Registro de participación científica</b>
            </td>
          </tr>
        </table>

        <hr>
        <br>
        <form enctype="multipart/form-data" method="post" action="${id_explab}">
          {% csrf_token %}


          <div class="form-grid card bg-light" style="margin-bottom:16px">

            <div>{{ form.nombre_evento_cientifico|as_crispy_field }}</div>
            <div>{{ form.tipo_evento|as_crispy_field }}</div>
            <div>{{ form.institucion_evento|as_crispy_field }}</div>

            <div>{{ form.ciudad_evento|as_crispy_field }}</div>
            <div>{{ form.pais_evento|as_crispy_field }}</div>
            <div>{{ form.fecha_inicio_evento|as_crispy_field }}</div>

            <div>{{ form.fecha_fin_evento|as_crispy_field }}</div>
            <div>{{ form.modalidad_evento|as_crispy_field }}</div>
            <div>{{ form.departamento_evento|as_crispy_field }}</div>
          
          </div>

          <div class="form-grid card bg-light">
            <!-- Soporte ocupa toda la fila -->
            <div>
                {{ form.soportes_eventos_cientificos|as_crispy_field }}
                <div id="askdjfls" style="color:blue"></div>            
            </div>
              <a id="ref_img_ver" onclick="funcionVisualizarModal('${soportes_eventos_cientificos}')"></a>
          </div>


          <br>
          <hr>

      <table width="100%">
        <tr>
          <td width="90%">
          <div class="d-flex justify-content-end gap-2 mt-3">
                <button class="btn btn-sm btn-outline-success" type="submit">
                  <table>
                    <tr>
                      <td>
                        <img src="{% static 'bs532/img/imghv/guardar.svg' %}"
                          style="display: flex; width:20px;align-items: center;" alt="My image">
                      </td>
                      <td>
                        Guardar
                      </td>
                    </tr>
                  </table>

                </button>


                <a onclick="ExperienciaLaboralOK()" class="btn btn-sm btn-outline-danger">

                  <table>
                    <tr>
                      <td>
                        <img src="{% static 'bs532/img/imghv/Cancelar.svg' %}"
                          style="display: flex; width:20px;align-items: center;" alt="My image">
                      </td>
                      <td>
                        Cancelar
                      </td>
                    </tr>
                  </table>
                </a>

              </div>

          </td>
        </tr>
      </table>
    </form>


  </div>
 `;

    if (condicional) {
      document.getElementById("id_nombre_evento_cientifico").value = nombre_evento_cientifico;
      document.getElementById("id_tipo_evento").value = tipo_evento;
      document.getElementById("id_institucion_evento").value = institucion_evento;
      document.getElementById("id_ciudad_evento").value = ciudad_evento;
      document.getElementById("id_departamento_evento").value = departamento_evento;
      document.getElementById("id_pais_evento").value = pais_evento;
      document.getElementById("id_fecha_inicio_evento").value = fecha_inicio_evento;
      document.getElementById("id_fecha_fin_evento").value = fecha_fin_evento;
      document.getElementById("id_modalidad_evento").value = modalidad_evento;
      document.getElementById("id_soportes_eventos_cientificos").required = false;
      document.getElementById("askdjfls").innerHTML = soportes_eventos_cientificos.split("/")[7]

      const btn_ver_img = document.getElementById("ref_img_ver");
      btn_ver_img.innerHTML = ` <img src="{% static 'bs532/img/ver_violeta.svg' %}" style="width:20px; cursor: pointer;margin-top: 40px;"">`

    } else {
      document.getElementById("askdjfls").innerHTML = ``;
      document.getElementById("mostrar_pdf_cargado").innerHTML = ``;
      //document.getElementById("id_titulo_disertacion").placeholder = "Nombre de su desertacion";
    }

  }

  function ExperienciaLaboralOK() {
    registro_experiencia_laboral.innerHTML = ``
    experiencia_laboral.innerHTML = `
    
  <div class="class_div" >
  
    <table style="width:100%">
      <tr>
        <td width="35px">
          <img src="{% static 'bs532/img/imghv/einstein.svg' %}" style="width: 100%;transform: scale(0.8)" alt="My image">
        </td>
        <td width="15px">

        </td>
        <td style="font-size:15px;">
          <b class="text-uppercase">Participación científica</b>
        </td>
        <td style="font-size:15px;">
          <a href="{% url 'hojadevida' %}" class="btn btn-sm btn-outline-danger float-end">
            <b>salir</b>
          </a>
        </td>

      </tr>
    </table>
      <br>
    <table width="100%">
      <tr>
       


        <td>
          <a class="btn btn-sm btn-outline-success float-end" onclick="RegistroExperienciaLaboral()">
          Agregar evento
          </a>
        </td>
         <td width="1%"></td>

        <td width="35%">
          <div class="input-group mb-0">
              <span class="input-group-text" id="basic-addon1">buscar</span>
            <input type="text" class="form-control" placeholder="Buscar" aria-label="Username" aria-describedby="basic-addon1">
          </div>
        </td>
      </tr>
    </table>
    <div style="height:8px;width: 100%; background-color:rgba(255, 0, 0, 0) ;"></div>

    <div class="container-vertical">

    <table class="competencias-table">
            <thead>
                <tr>
                    <th>Nombre evento</th>
                    <th>Tipo</th>
                    <th>Institución</th>
                    <th>Hubicación</th>
                    <th>Periodo</th>
                    <th>Rol</th>
                    <th class="acciones-col">Alternativas</th>
                </tr>
            </thead>

            <tbody>
                {% for qrdat in querydat %}
                <tr>
                      <td >
                        {{ qrdat.nombre_evento_cientifico }}
                      </td>

                        <td >
                        {{ qrdat.tipo_evento }}
                      </td>

                      <td >
                        {{qrdat.institucion_evento }}
                      </td>

                      <td >
                          {{ qrdat.ciudad_evento}} - {{ qrdat.pais_evento }}
                      </td>
     
                      <td >
                          {{ qrdat.fecha_inicio_evento|date:"d/m/Y"}} -  {{ qrdat.fecha_fin_evento|date:"d/m/Y"}}
                      
                      </td>

                      <td >
                           {{qrdat.modalidad_evento}}
                      </td>


                  <td class="acciones" >
                        <!-- Ver soporte -->
                        <button type="button" class="icon-btn"
                            onclick="funcionVisualizarModal('{{ qrdat.documento_url }}','Certificado de evento - {{ qrdat.tipo_evento }}')">
                            <img src="{% static 'bs532/img/ver_violeta.svg' %}" alt="Ver">
                        </button>

                    <!-- Editar -->
                        <!-- Editar -->
                            <button type="button" class="editar-registro icon-btn" onclick="RegistroExperienciaLaboral(
                            true,'{{qrdat.id}}','{{qrdat.nombre_evento_cientifico}}','{{qrdat.tipo_evento}}','{{qrdat.institucion_evento}}',
                            '{{ qrdat.ciudad_evento }}','{{ qrdat.departamento_evento }}','{{ qrdat.pais_evento }}',
                            '{{ qrdat.fecha_inicio_evento|date:"Y-m-d" }}', '{{ qrdat.fecha_fin_evento|date:"Y-m-d" }}','{{qrdat.modalidad_evento}}',
                            '{{ qrdat.documento_url }}')" style="cursor:pointer">
                        
                                    <img src="{% static 'bs532/img/editar.svg' %}" alt="Editar">
                                </button>

                        <!-- Eliminar -->
                        <a href="{% url 'delete_file_record' 'ParticipacionCientifica' qrdat.id %}" class="icon-btn">
                            <img src="{% static 'bs532/img/eliminar.svg' %}" alt="Eliminar">
                        </a>
                      </td>
                </tr>
               
                {% endfor %}
            </tbody>
        </table>
        </div>
  </div>
 `;
  }
</script>





<div class="posicion_hv_html">
  <div id="registro_experiencia_laboral"></div>
  <div id="experiencia_laboral"></div>
</div>


{% if errform %}
<script>
  window.addEventListener("load", async () => {
    await RegistroExperienciaLaboral();
  });

</script>
{% else %}
<script>
  const registro_experiencia_laboral = document.getElementById("registro_experiencia_laboral");
  const experiencia_laboral = document.getElementById("experiencia_laboral");
  window.addEventListener("load", async () => {
    await ExperienciaLaboralOK();
  });
</script>
{% endif %}

{% endblock content_derecho %}